<ion-header>
  <ion-toolbar>
    <ion-title>Uda-Spice Latte Cafe</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Actions -->
  <ion-button expand="block" (click)="loadShort()">REFRESH (SHORT)</ion-button>

  <ion-button
    expand="block"
    color="medium"
    *ngIf="auth.can('get:drinks-detail')"
    (click)="loadDetailIfAllowed()">
    LOAD DETAILS
  </ion-button>

  <ion-button
    expand="block"
    color="success"
    *ngIf="auth.can('post:drinks')"
    (click)="openNewDrinkModal()">
    NEW DRINK
  </ion-button>

  <!-- Loading -->
  <div *ngIf="loading" class="ion-margin-top">
    <ion-spinner name="dots"></ion-spinner>
    <div>Loading drinks…</div>
  </div>

  <!-- Error -->
  <ion-card color="danger" *ngIf="!loading && errorMsg">
    <ion-card-header>
      <ion-card-title>Fehler</ion-card-title>
    </ion-card-header>
    <ion-card-content>{{ errorMsg }}</ion-card-content>
  </ion-card>

  <!-- Empty -->
  <ion-card *ngIf="!loading && !errorMsg && (!drinks || drinks.length === 0)">
    <ion-card-content>No drinks found.</ion-card-content>
  </ion-card>

  <!-- Card strip -->
  <div *ngIf="!loading && !errorMsg && drinks?.length"
       class="card-strip ion-padding-start ion-padding-end">

    <ion-card class="drink-card"
              *ngFor="let d of drinks"
              (click)="auth.can('get:drinks-detail') && openEditDrinkModal(d)">
      <ion-card-header>
        <ion-card-title class="drink-title" [title]="d.title">{{ d.title }}</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <!-- Simple “cup” made of stacked color bars -->
        <div class="swatch">
          <div class="layer"
               *ngFor="let r of (d.recipe || [])"
               [style.background]="r.color"
               [style.height.%]="100 / ((d.recipe?.length || 1))">
          </div>
        </div>
      </ion-card-content>

      <!-- Manager actions -->
      <ion-item lines="none" class="card-actions"
                *ngIf="auth.can('patch:drinks') || auth.can('delete:drinks')">
        <ion-buttons slot="end">
          <ion-button fill="clear" size="small"
                      *ngIf="auth.can('patch:drinks')"
                      (click)="$event.stopPropagation(); openEditDrinkModal(d)">
            <ion-icon name="create-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button fill="clear" color="danger" size="small"
                      *ngIf="auth.can('delete:drinks')"
                      (click)="$event.stopPropagation(); deleteDrink(d.id!)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-card>

  </div>

</ion-content>
